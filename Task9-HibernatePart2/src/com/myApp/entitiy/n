import com.myApp.entitiy.Product;
import com.myApp.entitiy.User;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.cfg.Configuration;
import org.hibernate.query.Query;

import java.time.LocalDate;
import java.util.List;

public class Main {
    public static void main(String[] args) {
        // SessionFactory Setting
        SessionFactory sessionFactory = new Configuration()
                .configure("hibernate-config.xml")
                .addAnnotatedClass(Product.class)
                .addAnnotatedClass(User.class)
                .buildSessionFactory();


        Session session = sessionFactory.getCurrentSession();

        try {
            //START
            session.beginTransaction();

            // --------------- HQL
            Double avgPrice = (Double) session.createQuery("select avg(p.price) from Product p").getSingleResult();
            System.out.println("Average Product Price: " + String.format("%.2f", avgPrice) + " $");


            Long totalStock = (Long) session.createQuery("select sum(p.stockQuantity) from Product p").getSingleResult();
            System.out.println("Total Stock: " + totalStock);

            // ------------------------ Update Data

            Product productToUpdate = session.get(Product.class, 1);
            if (productToUpdate != null) {
                productToUpdate.setPrice(99.99);

            }

            // --------- Pagination
            Query query = session.createQuery("from Product");
            query.setFirstResult(5);
            query.setMaxResults(10);

            List list = query.getResultList();


            for (Object obj : list) {
                Product p = (Product) obj;
                System.out.println(p);
            }
            User newUser = new User();
            newUser.setUsername("Tala");
            newUser.setPassword("Pass123");
            newUser.setEmail("tala@gmail.com");

            session.save(newUser);
            System.out.println("\n New User: " + newUser.getUsername());

            session.getTransaction().commit();




        } finally {
            // CLOSE tabase connection
            sessionFactory.close();
        }
    }
}